title: golang拾遗三测试
author: 江小渔
tags:
  - golang
categories:
  - golang
  - ''
date: 2019-12-09 14:38:00
---
# 测试
1. 对于功能测试函数来说，其名称必须以Test为前缀，并且参数列表中只应有一个*testing.T类型的参数声明。
2. 对于性能测试函数来说，其名称必须以Benchmark为前缀，并且唯一参数的类型必须是*testing.B类型的。
3. 对于示例测试函数来说，其名称必须以Example为前缀，但对函数的参数列表没有强制规定。
## 命令与参数
- go test
- go test 
- go clean -cache(手动删除所有的缓存数据)
- go clean -testcache(删除所有的测试结果缓存)
- go test -bench=. -run=^$ -cpu 2,4 -count 2 (性能测试)
```
-bench=.，只有有了这个标记，命令才会进行性能测试。该标记的值.表明需要执行任意名称的性能测试函数

-run=^$，这个标记用于表明需要执行哪些功能测试函数，这同样也是以函数名称为依据的。该标记的值^$意味着：只执行名称为空的功能测试函数，换句话说，不执行任何功能测试函数

-cpu的值应该是一个正整数的列表，该列表的表现形式为：以英文半角逗号分隔的多个整数字面量，比如1,2,4
以1,2,4为例，go test命令会先以1,2,4为最大 P 数量分别去执行第一个测试函数，之后再用同样的方式执行第二个测试函数，以此类推。

-count标记是专门用于重复执行测试函数的。它的值必须大于或等于0，并且默认值为1。
如果我们在运行go test命令的时候追加了-count 5，那么对于每一个测试函数，命令都会在预设的不同条件下（比如不同的最大 P 数量下）分别重复执行五次。
```
go test命令的一次运行过程中的执行次数，即：
```
性能测试函数的执行次数 = `-cpu`标记的值中正整数的个数 x `-count`标记的值 x 探索式执行中测试函数的实际执行次数
功能测试函数的执行次数 = `-cpu`标记的值中正整数的个数 x `-count`标记的值
```
- -parallel标记
``` 
在运行go test命令的时候，可以追加标记-parallel，该标记的作用是：设置同一个被测代码包中的功能测试函数的最大并发执行数。该标记的默认值是测试运行时的最大 P 数量（这可以通过调用表达式runtime.GOMAXPROCS(0)获得）
```
- testing.B类型有这么几个指针方法：StartTimer、StopTimer和ResetTimer
```
通过对b.StartTimer和b.StopTimer方法的联合运用，再去除掉任何一段代码的执行时间
b.ResetTimer方法的灵活性就要差一些了，它只能用于：去除在调用它之前那些代码的执行时间。不过，无论在调用它的时候，计时器是不是正在运行，它都可以起作用。
```
- t.Log/t.Logf
```
t.Log方法以及t.Logf方法的作用，就是打印常规的测试日志，只不过当测试成功的时候，go test命令就不会打印这类日志了。如果你想在测试结果中看到所有的常规测试日志，那么可以在运行go test命令的时候加入标记-v。
```
- t.Fail()/t.FailNow()失败/立即失败
```
调用t.Fail方法时，虽然当前的测试函数会继续执行下去，但是结果会显示该测试失败。
t.FailNow()执行之后，当前函数会立即终止执行。换句话说，该行代码之后的所有代码都会失去执行机会。
```
- t.Error/t.Errorf
```
前者相当于t.Log方法和t.Fail方法的连续调用，而后者也与之类似，只不过它相当于先调用了t.Logf方法。
```
- 代码覆盖率
```go
go test -v -cover
```
- 断言
	- github.com/stretchr/testify